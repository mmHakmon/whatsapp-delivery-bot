<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××™×©×•×¨ ××¡×™×¨×” - M.M.H</title>
  <link rel="icon" type="image/png" href="/logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>* { font-family: 'Heebo', sans-serif; }</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white flex items-center justify-center p-4">
  <div id="app" class="w-full max-w-md"><div class="text-center py-12"><div class="animate-spin text-4xl mb-4">â³</div><p class="text-gray-400">×˜×•×¢×Ÿ...</p></div></div>
  <script>
    const orderNumber = window.location.pathname.split('/')[2];
    
    async function loadOrder() {
      try {
        const res = await fetch('/api/orders/public/' + orderNumber);
        const order = await res.json();
        if (!order || order.error) { showError('×”××©×œ×•×— ×œ× × ××¦×'); return; }
        if (order.status !== 'picked') {
          if (order.status === 'delivered') showAlreadyDelivered(order);
          else if (order.status === 'taken') showNeedPickup(order);
          else showError('×œ× × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×¡×˜×˜×•×¡ ×–×”');
          return;
        }
        showDeliveryForm(order);
      } catch (e) { showError('×©×’×™××” ×‘×˜×¢×™× ×”'); }
    }
    
    function showDeliveryForm(order) {
      document.getElementById('app').innerHTML = `
        <div class="bg-slate-800/80 backdrop-blur rounded-2xl overflow-hidden shadow-2xl">
          <div class="bg-gradient-to-r from-emerald-600 to-cyan-500 p-6 text-center">
            <div class="text-4xl mb-2">ğŸ </div>
            <h1 class="text-xl font-bold">××™×©×•×¨ ××¡×™×¨×”</h1>
            <div class="text-lg opacity-90 mt-1">${order.order_number}</div>
          </div>
          <div class="p-6 space-y-4">
            <div class="bg-slate-700/50 rounded-xl p-4">
              <div class="text-sm text-gray-400 mb-1">ğŸ  ×›×ª×•×‘×ª ××¡×™×¨×”</div>
              <div class="font-medium">${order.delivery_address}</div>
            </div>
            <div class="bg-slate-700/50 rounded-xl p-4">
              <div class="text-sm text-gray-400 mb-1">ğŸ‘¤ ××§×‘×œ</div>
              <div class="font-medium">${order.receiver_name}</div>
              <a href="tel:${order.receiver_phone}" class="text-cyan-400">${order.receiver_phone}</a>
            </div>
            <div class="bg-emerald-500/20 rounded-xl p-4 text-center">
              <div class="text-sm text-gray-400 mb-1">ğŸ’° ×”×¨×•×•×—×ª</div>
              <div class="text-3xl font-bold text-emerald-400">â‚ª${order.courier_payout}</div>
            </div>
            <a href="https://waze.com/ul?q=${encodeURIComponent(order.delivery_address)}" target="_blank" class="block w-full bg-slate-700 text-center text-white py-3 rounded-xl font-medium">ğŸ—ºï¸ × ×™×•×•×˜</a>
            <button onclick="confirmDelivery()" id="confirmBtn" class="w-full bg-gradient-to-r from-emerald-600 to-cyan-500 text-white py-4 rounded-xl font-bold text-lg">âœ… ××¡×¨×ª×™ ×‘×”×¦×œ×—×”</button>
          </div>
        </div>`;
    }
    
    function showNeedPickup(order) {
      document.getElementById('app').innerHTML = `
        <div class="bg-slate-800/80 backdrop-blur rounded-2xl overflow-hidden shadow-2xl text-center p-8">
          <div class="text-6xl mb-4">ğŸ“¦</div>
          <h1 class="text-xl font-bold text-amber-400 mb-2">×§×•×“× ×¦×¨×™×š ×œ××¡×•×£!</h1>
          <p class="text-gray-400 mb-6">×¢×“×›×Ÿ ×©××¡×¤×ª ××ª ×”×—×‘×™×œ×” ×œ×¤× ×™ ××™×©×•×¨ ××¡×™×¨×”</p>
          <a href="/status/${order.order_number}/pickup" class="inline-block bg-gradient-to-r from-blue-600 to-cyan-500 text-white px-8 py-4 rounded-xl font-bold">ğŸ“¦ ×œ××™×©×•×¨ ××™×¡×•×£</a>
        </div>`;
    }
    
    function showAlreadyDelivered(order) {
      document.getElementById('app').innerHTML = `
        <div class="bg-slate-800/80 backdrop-blur rounded-2xl overflow-hidden shadow-2xl text-center p-8">
          <div class="text-6xl mb-4">ğŸ‰</div>
          <h1 class="text-2xl font-bold text-emerald-400 mb-2">×”××©×œ×•×— ×›×‘×¨ × ××¡×¨!</h1>
          <div class="bg-emerald-500/20 rounded-xl p-4 inline-block mt-4">
            <div class="text-sm text-gray-400">×”×¨×•×•×—×ª</div>
            <div class="text-3xl font-bold text-emerald-400">â‚ª${order.courier_payout}</div>
          </div>
          <p class="text-gray-400 mt-6">×ª×•×“×”! ğŸ™</p>
        </div>`;
    }
    
    async function confirmDelivery() {
      const btn = document.getElementById('confirmBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="animate-pulse">××¢×“×›×Ÿ...</span>';
      try {
        const res = await fetch('/api/status/' + orderNumber + '/deliver', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
        const result = await res.json();
        if (result.success) showSuccess();
        else { alert(result.error || '×©×’×™××”'); btn.disabled = false; btn.textContent = 'âœ… ××¡×¨×ª×™ ×‘×”×¦×œ×—×”'; }
      } catch (e) { alert('×©×’×™××ª ×¨×©×ª'); btn.disabled = false; btn.textContent = 'âœ… ××¡×¨×ª×™ ×‘×”×¦×œ×—×”'; }
    }
    
    function showSuccess() {
      document.getElementById('app').innerHTML = `
        <div class="bg-slate-800/80 backdrop-blur rounded-2xl overflow-hidden shadow-2xl text-center p-8">
          <div class="text-6xl mb-4">ğŸ‰</div>
          <h1 class="text-2xl font-bold text-emerald-400 mb-2">× ××¡×¨ ×‘×”×¦×œ×—×”!</h1>
          <p class="text-gray-400 mb-6">×›×œ ×”×›×‘×•×“! ×”××©×œ×•×— ×”×•×©×œ×</p>
          <p class="text-gray-500 text-sm">×ª×•×“×” ×©×‘×—×¨×ª ×‘-M.M.H! ğŸš€</p>
        </div>`;
    }
    
    function showError(msg) {
      document.getElementById('app').innerHTML = `<div class="bg-slate-800/80 backdrop-blur rounded-2xl p-8 text-center"><div class="text-6xl mb-4">âŒ</div><h1 class="text-xl font-bold text-red-400">${msg}</h1></div>`;
    }
    
    loadOrder();
  </script>
</body>
</html>
